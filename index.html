<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ball Possession (Smaller Bars), Stats (Bigger Bars) + Momentum</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #f8f8f8;
      font-family: "Inter", sans-serif;
      text-align: center; /* center the canvases horizontally */
    }

    /*
      Each canvas can be up to 90% viewport width and 900px max.
      We rely on Chart.js's maintainAspectRatio for a 2:1 ratio (unless changed).
    */
    canvas {
      display: inline-block;
      width: 90vw;
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <!-- Possession Chart (one row, smaller bars) -->
  <canvas id="possessionChart"></canvas>

  <!-- Single chart for all other stats, bigger bars -->
  <canvas id="statsChart"></canvas>

  <!-- Momentum Line Chart -->
  <canvas id="momentumChart"></canvas>

  <script>
    /*************************************************************
     * 1) GLOBAL COLORS
     *************************************************************/
    const HOME_COLOR = "#fa3048"; // Home color
    const AWAY_COLOR = "#2c2c2c"; // Away color

    /*************************************************************
     * 2) PARSE URL PARAMS
     *************************************************************/
    const params = new URLSearchParams(window.location.search);

    // Ball Possession
    const possessionHome = Number(params.get("possessionHome") || 0);
    const possessionAway = Number(params.get("possessionAway") || 0);

    // Other Stats
    const homeShots         = Number(params.get("home_shots")         || 0);
    const awayShots         = Number(params.get("away_shots")         || 0);
    const homeShotsOnGoal   = Number(params.get("home_shots_on_goal") || 0);
    const awayShotsOnGoal   = Number(params.get("away_shots_on_goal") || 0);
    const homeGoalChances   = Number(params.get("home_goal_chances")  || 0);
    const awayGoalChances   = Number(params.get("away_goal_chances")  || 0);
    const homeDuelsWon      = Number(params.get("home_duels_won")     || 0);
    const awayDuelsWon      = Number(params.get("away_duels_won")     || 0);
    const homeSaves         = Number(params.get("home_saves")         || 0);
    const awaySaves         = Number(params.get("away_saves")         || 0);
    const homeCorners       = Number(params.get("home_corners")       || 0);
    const awayCorners       = Number(params.get("away_corners")       || 0);
    const homeFouls         = Number(params.get("home_fouls")         || 0);
    const awayFouls         = Number(params.get("away_fouls")         || 0);
    const homeYellows       = Number(params.get("home_yellows")       || 0);
    const awayYellows       = Number(params.get("away_yellows")       || 0);
    const homeReds          = Number(params.get("home_reds")          || 0);
    const awayReds          = Number(params.get("away_reds")          || 0);

    // Momentum
    const rawTimeTracker = params.get("time_tracker")    || "0,15,30,45,60,75,90";
    const rawMomentum    = params.get("momentum_tracker")|| "0.5,0.55,0.6,0.55,0.4,0.7,0.6";
    const timeData       = rawTimeTracker.split(",").map(x => Number(x.trim()));
    const homeMomentumData = rawMomentum.split(",").map(x => Number(x.trim()));
    const awayMomentumData = homeMomentumData.map(v => 1 - v);

    /*************************************************************
     * 3) CREATE POSSESSION CHART (Smaller bars)
     *************************************************************/
    (function createPossessionChart() {
      new Chart(document.getElementById("possessionChart").getContext("2d"), {
        type: "bar",
        data: {
          labels: ["Ball Possession"],
          datasets: [
            {
              label: "Home",
              data: [possessionHome],
              backgroundColor: HOME_COLOR,
              borderRadius: 6
            },
            {
              label: "Away",
              data: [possessionAway],
              backgroundColor: AWAY_COLOR,
              borderRadius: 6
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          indexAxis: "y",
          plugins: {
            title: {
              display: true,
              text: "Ball Possession",
              font: {
                family: "Inter",
                weight: "700",
                size: 16
              },
              padding: { top: 10, bottom: 10 }
            },
            legend: {
              display: true,
              position: "top",
              labels: {
                font: { family: 'Inter', weight: '700' }
              }
            },
            tooltip: {
              titleFont: { family: 'Inter', weight: '700' },
              bodyFont:  { family: 'Inter' },
              callbacks: {
                label: (ctx) => {
                  const val = ctx.parsed.x || 0;
                  const who = ctx.dataset.label || "";
                  return `${who}: ${val}`;
                }
              }
            }
          },
          elements: {
            bar: {
              // Slightly smaller bars for possession
              barPercentage: 0.2,
              categoryPercentage: 0.5
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: {
                font: { family: 'Inter', weight: '700' },
                color: "#666"
              },
              grid: { display: true }
            },
            y: {
              ticks: { display: false },
              grid: { display: false }
            }
          }
        }
      });
    })();

    /*************************************************************
     * 4) CREATE SINGLE STATS CHART (Bigger Bars + More Spacing)
     *************************************************************/
    const statLabels = [
      "Shots",
      "Shots on Goal",
      "Goal Chances",
      "Duels Won",
      "Saves",
      "Corners",
      "Fouls",
      "Yellows",
      "Reds"
    ];

    const homeVals = [
      homeShots,
      homeShotsOnGoal,
      homeGoalChances,
      homeDuelsWon,
      homeSaves,
      homeCorners,
      homeFouls,
      homeYellows,
      homeReds
    ];

    const awayVals = [
      awayShots,
      awayShotsOnGoal,
      awayGoalChances,
      awayDuelsWon,
      awaySaves,
      awayCorners,
      awayFouls,
      awayYellows,
      awayReds
    ];

    (function createStatsChart() {
      new Chart(document.getElementById("statsChart").getContext("2d"), {
        type: "bar",
        data: {
          labels: statLabels,
          datasets: [
            {
              label: "Home",
              data: homeVals,
              backgroundColor: HOME_COLOR,
              borderRadius: 6
            },
            {
              label: "Away",
              data: awayVals,
              backgroundColor: AWAY_COLOR,
              borderRadius: 6
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          indexAxis: "y",
          plugins: {
            title: {
              display: true,
              text: "Stats",
              font: {
                family: "Inter",
                weight: "700",
                size: 16
              },
              padding: { top: 10, bottom: 10 }
            },
            legend: {
              display: true,
              position: "top",
              labels: {
                font: { family: 'Inter', weight: '700' }
              }
            },
            tooltip: {
              titleFont: { family: 'Inter', weight: '700' },
              bodyFont:  { family: 'Inter' },
              callbacks: {
                label: (ctx) => {
                  const val = ctx.parsed.x || 0;
                  const who = ctx.dataset.label || "";
                  return `${who}: ${val}`;
                }
              }
            }
          },
          elements: {
            bar: {
              /*
                barPercentage: how thick each bar is.
                categoryPercentage: spacing between rows.
                Increase these for bigger bars & more row spacing.
              */
              barPercentage: 0.8,
              categoryPercentage: 0.9
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: {
                font: { family: 'Inter', weight: '700' },
                color: "#666"
              },
              grid: { display: true }
            },
            y: {
              ticks: {
                color: "#000",
                font: { family: "Inter", weight: "700" }
              },
              grid: { display: false }
            }
          }
        }
      });
    })();

    /*************************************************************
     * 5) MOMENTUM CHART
     *************************************************************/
    (function createMomentumChart() {
      new Chart(document.getElementById("momentumChart").getContext("2d"), {
        type: "line",
        data: {
          labels: timeData,
          datasets: [
            {
              label: "Home Momentum",
              data: homeMomentumData,
              borderColor: HOME_COLOR,
              borderWidth: 4, // line thickness
              radius: 0
            },
            {
              label: "Away Momentum",
              data: awayMomentumData,
              borderColor: AWAY_COLOR,
              borderWidth: 4,
              radius: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            x: {
              type: "linear",
              title: {
                display: true,
                text: "Time (minutes)",
                font: { family: "Inter", weight: "700" }
              },
              ticks: {
                font: { family: "Inter", weight: "700" }
              }
            },
            y: {
              min: 0,
              max: 1.2,
              title: {
                display: true,
                text: "Momentum",
                font: { family: "Inter", weight: "700" }
              },
              ticks: {
                font: { family: "Inter", weight: "700" }
              }
            }
          },
          plugins: {
            legend: {
              display: true,
              position: "top",
              labels: {
                font: { family: "Inter", weight: "700" }
              }
            },
            tooltip: {
              mode: "index",
              intersect: false,
              titleFont: { family: "Inter", weight: "700" },
              bodyFont:  { family: "Inter" }
            }
          },
          interaction: {
            mode: "index",
            intersect: false
          }
        }
      });
    })();
  </script>
</body>
</html>
