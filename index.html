<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Match Stats & Momentum</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      overflow-y: auto; /* Allow vertical scrolling */
      margin: 0;
      padding: 0;
      font-family: "Inter", sans-serif;
      background: #f8f8f8;
      text-align: center;
      min-height: 100vh;
    }

    .chart-container {
      width: 90vw;
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px 20px 30px 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .chart-container:last-child {
      margin-bottom: 60px;
    }

    /* Possession Chart styling */
    #possessionChart {
      width: 100%;
      max-width: 400px;
      margin: auto;
      min-height: 400px;
    }

    /* Polar Charts styling */
    .polar-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .polar-chart-box {
      flex: 1 1 400px;
      max-width: 400px;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <!-- 1) Two-Sided Bar Chart (Match Stats) -->
  <div class="chart-container">
    <div id="statsChart"></div>
  </div>

  <!-- 2) Momentum Chart -->
  <div class="chart-container">
    <div id="momentumChart"></div>
  </div>

  <!-- 3) Possession Chart -->
  <div class="chart-container">
    <div id="possessionChart"></div>
  </div>

  <!-- 4) Polar-Area Charts (Zone Strength) -->
  <div class="chart-container">
    <h2 style="margin-bottom: 10px;">Zone Strengths (Polar Charts)</h2>
    <div class="polar-grid">
      <div class="polar-chart-box">
        <div id="polarHomeAttack"></div>
      </div>
      <div class="polar-chart-box">
        <div id="polarHomeDefend"></div>
      </div>
      <div class="polar-chart-box">
        <div id="polarAwayAttack"></div>
      </div>
      <div class="polar-chart-box">
        <div id="polarAwayDefend"></div>
      </div>
    </div>
  </div>

  <script>
    /*************************************************************
     * GLOBAL COLORS & PARSING
     *************************************************************/
    // For Momentum & Possession
    const HOME_COLOR = "#fa3048";
    const AWAY_COLOR = "#2c2c2c";

    // For two-sided bar chart
    const HOME_BAR_COLOR = "#2ECC71"; // Green
    const AWAY_BAR_COLOR = "#3498DB"; // Blue

    const params = new URLSearchParams(window.location.search);

    function numParam(name, defaultVal = 0) {
      const val = params.get(name);
      return val ? Number(val) : defaultVal;
    }

    // 1) Parse Stats
    const homeStats = [
      numParam("home_shots"), 
      numParam("home_shots_on_goal"),
      numParam("home_goal_chances"), 
      numParam("home_duels_won"),
      numParam("home_saves"), 
      numParam("home_corners"),
      numParam("home_fouls"), 
      numParam("home_yellows"),
      numParam("home_reds")
    ];
    const awayStats = [
      numParam("away_shots"), 
      numParam("away_shots_on_goal"),
      numParam("away_goal_chances"), 
      numParam("away_duels_won"),
      numParam("away_saves"), 
      numParam("away_corners"),
      numParam("away_fouls"), 
      numParam("away_yellows"),
      numParam("away_reds")
    ];
    const statLabels = [
      "Shots", "Shots on Goal", "Goal Chances", "Duels Won",
      "Saves", "Corners", "Fouls", "Yellows", "Reds"
    ];

    // 2) Momentum
    const rawTimeTracker = params.get("time_tracker") || "0,15,30,45,60,75,90";
    const rawMomentum = params.get("momentum_tracker") || "0.5,0.55,0.6,0.55,0.4,0.7,0.6";
    const timeData = rawTimeTracker.split(",").map(x => +x.trim());
    const homeMomentumData = rawMomentum.split(",").map(x => +x.trim());
    const awayMomentumData = homeMomentumData.map(v => 1 - v);

    // 3) Possession
    const possessionHome = numParam("possessionHome", 50);
    const possessionAway = numParam("possessionAway", 50);

    // 4) Zone Strength (Polar)
    const zoneLabels = ["Buildup", "Midfield", "Wingplay", "Last Third"];
    const homeAttackData = [
      numParam("home_attack_buildup"),
      numParam("home_attack_midfield"),
      numParam("home_attack_wingplay"),
      numParam("home_attack_lastthird")
    ];
    const homeDefendData = [
      numParam("home_defend_buildup"),
      numParam("home_defend_midfield"),
      numParam("home_defend_wingplay"),
      numParam("home_defend_lastthird")
    ];
    const awayAttackData = [
      numParam("away_attack_buildup"),
      numParam("away_attack_midfield"),
      numParam("away_attack_wingplay"),
      numParam("away_attack_lastthird")
    ];
    const awayDefendData = [
      numParam("away_defend_buildup"),
      numParam("away_defend_midfield"),
      numParam("away_defend_wingplay"),
      numParam("away_defend_lastthird")
    ];
    const ZONE_COLORS = ["#008FFB", "#00E396", "#FEB019", "#FF4560"];

    /*************************************************************
     * 1) TWO-SIDED BAR CHART (Match Stats) with symmetrical axis
     *************************************************************/
    // Convert Home stats to negative values so bars extend left
    const homeStatsNegative = homeStats.map(val => -val);

    // Find max absolute value to set symmetrical min/max
    const maxVal = Math.max(
      ...homeStats.map(Math.abs),
      ...awayStats.map(Math.abs)
    );

    new ApexCharts(document.querySelector("#statsChart"), {
      chart: { type: "bar", height: 400 },
      series: [
        { name: "Home", data: homeStatsNegative },
        { name: "Away", data: awayStats }
      ],
      xaxis: {
        categories: statLabels,
        labels: {
          formatter: (val) => Math.abs(val).toString()
        },
        min: -maxVal,
        max: maxVal
      },
      yaxis: {
        reversed: true // top category on top
      },
      plotOptions: {
        bar: {
          horizontal: true,
          barHeight: "60%",
          dataLabels: {
            position: "center"
          }
        }
      },
      dataLabels: {
        enabled: true,
        formatter: (val) => Math.abs(val),
        style: {
          fontSize: "12px",
          fontFamily: "Inter",
          fontWeight: "700"
        }
      },
      colors: [HOME_BAR_COLOR, AWAY_BAR_COLOR],
      title: {
        text: "Match Stats",
        align: "center",
        style: { fontSize: "16px", fontFamily: "Inter", fontWeight: "700" }
      },
      legend: { position: "top" }
    }).render();

    /*************************************************************
     * 2) MOMENTUM (Line Chart)
     *************************************************************/
    new ApexCharts(document.querySelector("#momentumChart"), {
      chart: {
        type: "line",
        height: 350,
        zoom: { enabled: false },
        toolbar: { show: false }
      },
      series: [
        { name: "Home Momentum", data: homeMomentumData },
        { name: "Away Momentum", data: awayMomentumData }
      ],
      xaxis: {
        categories: timeData,
        title: { text: "Time (minutes)", style: { fontFamily: "Inter", fontWeight: "700" } },
        tickAmount: 3,
        labels: { rotate: 0, style: { fontFamily: "Inter", fontWeight: "700" } }
      },
      yaxis: {
        min: 0, max: 1,
        tickAmount: 2,
        labels: { formatter: (val) => val.toFixed(1), style: { fontFamily: "Inter", fontWeight: "700" } },
        title: { text: "Momentum", style: { fontFamily: "Inter", fontWeight: "700" } }
      },
      stroke: { width: 4 },
      colors: [HOME_COLOR, AWAY_COLOR],
      title: {
        text: "Momentum Over Time",
        align: "center",
        style: { fontSize: "16px", fontFamily: "Inter", fontWeight: "700" }
      },
      legend: { position: "top" }
    }).render();

    /*************************************************************
     * 3) POSSESSION (Donut Chart)
     *************************************************************/
    new ApexCharts(document.querySelector("#possessionChart"), {
      chart: {
        type: "donut",
        height: 350,
        width: "100%"
      },
      series: [possessionHome, possessionAway],
      labels: ["Home", "Away"],
      colors: [HOME_COLOR, AWAY_COLOR],
      title: {
        text: "Ball Possession",
        align: "center",
        style: { fontSize: "16px", fontFamily: "Inter", fontWeight: "700" }
      },
      legend: {
        position: "bottom",
        offsetY: 10,
        fontSize: "14px",
        fontFamily: "Inter"
      },
      dataLabels: {
        style: {
          fontSize: "14px",
          fontFamily: "Inter",
          fontWeight: "bold"
        }
      },
      plotOptions: {
        pie: {
          donut: {
            size: "65%"
          },
          expandOnClick: false
        }
      },
      responsive: [{
        breakpoint: 480,
        options: {
          chart: {
            height: 300
          }
        }
      }]
    }).render();

    /*************************************************************
     * 4) POLAR-AREA CHARTS (Zone Strengths)
     *************************************************************/
    // HOME ATTACKING
    new ApexCharts(document.querySelector("#polarHomeAttack"), {
      chart: { type: "polarArea", height: 350 },
      series: homeAttackData,
      labels: zoneLabels,
      colors: ZONE_COLORS,
      title: { text: "Home Attacking", align: "center" },
      legend: { position: "bottom" },
      stroke: { colors: ["#fff"] },
      fill: { opacity: 0.85 },
      yaxis: { show: false }
    }).render();

    // HOME DEFENDING
    new ApexCharts(document.querySelector("#polarHomeDefend"), {
      chart: { type: "polarArea", height: 350 },
      series: homeDefendData,
      labels: zoneLabels,
      colors: ZONE_COLORS,
      title: { text: "Home Defending", align: "center" },
      legend: { position: "bottom" },
      stroke: { colors: ["#fff"] },
      fill: { opacity: 0.85 },
      yaxis: { show: false }
    }).render();

    // AWAY ATTACKING
    new ApexCharts(document.querySelector("#polarAwayAttack"), {
      chart: { type: "polarArea", height: 350 },
      series: awayAttackData,
      labels: zoneLabels,
      colors: ZONE_COLORS,
      title: { text: "Away Attacking", align: "center" },
      legend: { position: "bottom" },
      stroke: { colors: ["#fff"] },
      fill: { opacity: 0.85 },
      yaxis: { show: false }
    }).render();

    // AWAY DEFENDING
    new ApexCharts(document.querySelector("#polarAwayDefend"), {
      chart: { type: "polarArea", height: 350 },
      series: awayDefendData,
      labels: zoneLabels,
      colors: ZONE_COLORS,
      title: { text: "Away Defending", align: "center" },
      legend: { position: "bottom" },
      stroke: { colors: ["#fff"] },
      fill: { opacity: 0.85 },
      yaxis: { show: false }
    }).render();

    // Force a small layout reflow after rendering
    setTimeout(() => {
      window.dispatchEvent(new Event("resize"));
    }, 100);

  </script>
</body>
</html>
