<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Match Stats & Momentum</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: "Inter", sans-serif;
      background: #f8f8f8;
      text-align: center;
      min-height: 100vh;
      overflow-y: auto;
    }

    .chart-container {
      width: 90vw;
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px 20px 30px 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .chart-container:last-child {
      margin-bottom: 60px;
    }

    #possessionChart {
      width: 100%;
      max-width: 400px;
      margin: auto;
      min-height: 400px;
    }
  </style>
</head>
<body>

  <!-- 1) Two-Sided Bar Chart (Match Stats) -->
  <div class="chart-container">
    <div id="statsChart"></div>
  </div>

  <!-- 2) Momentum Chart -->
  <div class="chart-container">
    <div id="momentumChart"></div>
  </div>

  <!-- 3) Possession Chart -->
  <div class="chart-container">
    <div id="possessionChart"></div>
  </div>

  <!-- 4) Home Zones: Attacking + Defending (bar+marker) -->
  <div class="chart-container">
    <h2>Home Zones</h2>
    <div id="homeZonesChart"></div>
  </div>

  <!-- 5) Away Zones: Attacking + Defending (bar+marker) -->
  <div class="chart-container">
    <h2>Away Zones</h2>
    <div id="awayZonesChart"></div>
  </div>

  <script>
    /*************************************************************
     * 1) GLOBAL COLORS & PARSING
     *************************************************************/
    const HOME_COLOR = "#fa3048"; // Red for Home
    const AWAY_COLOR = "#2c2c2c"; // Dark Gray for Away

    const params = new URLSearchParams(window.location.search);

    function numParam(name, defaultVal = 0) {
      const val = params.get(name);
      return val ? Number(val) : defaultVal;
    }

    /*************************************************************
     * 2) MATCH STATS: TWO-SIDED BAR
     *************************************************************/
    const homeStats = [
      numParam("home_shots"), 
      numParam("home_shots_on_goal"),
      numParam("home_goal_chances"), 
      numParam("home_duels_won"),
      numParam("home_saves"), 
      numParam("home_corners"),
      numParam("home_fouls"), 
      numParam("home_yellows"),
      numParam("home_reds")
    ];
    const awayStats = [
      numParam("away_shots"), 
      numParam("away_shots_on_goal"),
      numParam("away_goal_chances"), 
      numParam("away_duels_won"),
      numParam("away_saves"), 
      numParam("away_corners"),
      numParam("away_fouls"), 
      numParam("away_yellows"),
      numParam("away_reds")
    ];
    const statLabels = [
      "Shots", "Shots on Goal", "Goal Chances", "Duels Won",
      "Saves", "Corners", "Fouls", "Yellows", "Reds"
    ];

    // Convert home stats to negative
    const homeStatsNeg = homeStats.map(v => -v);
    // Find symmetrical min/max
    const maxVal = Math.max(...homeStats.map(Math.abs), ...awayStats.map(Math.abs));

    new ApexCharts(document.querySelector("#statsChart"), {
      chart: { type: "bar", height: 400 },
      series: [
        { name: "Home", data: homeStatsNeg },
        { name: "Away", data: awayStats }
      ],
      xaxis: {
        categories: statLabels,
        labels: {
          formatter: (val) => Math.abs(val).toString()
        },
        min: -maxVal,
        max: maxVal
      },
      yaxis: { reversed: true },
      plotOptions: {
        bar: {
          horizontal: true,
          barHeight: "60%",
          dataLabels: { position: "center" }
        }
      },
      dataLabels: {
        enabled: true,
        formatter: (val) => Math.abs(val),
        style: { fontSize: "12px", fontFamily: "Inter", fontWeight: "700" }
      },
      colors: [HOME_COLOR, AWAY_COLOR],
      title: {
        text: "Match Stats",
        align: "center",
        style: { fontSize: "16px", fontFamily: "Inter", fontWeight: "700" }
      },
      legend: { position: "top" }
    }).render();


    /*************************************************************
     * 3) MOMENTUM
     *************************************************************/
    const rawTimeTracker = params.get("time_tracker") || "0,15,30,45,60,75,90";
    const rawMomentum = params.get("momentum_tracker") || "0.5,0.55,0.6,0.55,0.4,0.7,0.6";
    const timeData = rawTimeTracker.split(",").map(x => +x.trim());
    const homeMomentumData = rawMomentum.split(",").map(x => +x.trim());
    const awayMomentumData = homeMomentumData.map(v => 1 - v);

    new ApexCharts(document.querySelector("#momentumChart"), {
      chart: {
        type: "line",
        height: 350,
        zoom: { enabled: false },
        toolbar: { show: false }
      },
      series: [
        { name: "Home Momentum", data: homeMomentumData },
        { name: "Away Momentum", data: awayMomentumData }
      ],
      xaxis: {
        categories: timeData,
        title: { text: "Time (minutes)", style: { fontFamily: "Inter", fontWeight: "700" } },
        tickAmount: 3,
        labels: { rotate: 0, style: { fontFamily: "Inter", fontWeight: "700" } }
      },
      yaxis: {
        min: 0, max: 1,
        tickAmount: 2,
        labels: {
          formatter: (val) => val.toFixed(1),
          style: { fontFamily: "Inter", fontWeight: "700" }
        },
        title: { text: "Momentum", style: { fontFamily: "Inter", fontWeight: "700" } }
      },
      stroke: { width: 4 },
      colors: [HOME_COLOR, AWAY_COLOR],
      title: {
        text: "Momentum Over Time",
        align: "center",
        style: { fontSize: "16px", fontFamily: "Inter", fontWeight: "700" }
      },
      legend: { position: "top" }
    }).render();


    /*************************************************************
     * 4) POSSESSION (Donut)
     *************************************************************/
    const possessionHome = numParam("possessionHome", 50);
    const possessionAway = numParam("possessionAway", 50);

    new ApexCharts(document.querySelector("#possessionChart"), {
      chart: { 
        type: "donut",
        height: 350,
        width: "100%"
      },
      series: [possessionHome, possessionAway],
      labels: ["Home", "Away"],
      colors: [HOME_COLOR, AWAY_COLOR],
      title: {
        text: "Ball Possession",
        align: "center",
        style: { fontSize: "16px", fontFamily: "Inter", fontWeight: "700" }
      },
      legend: {
        position: "bottom",
        offsetY: 10,
        fontSize: "14px",
        fontFamily: "Inter"
      },
      dataLabels: {
        style: {
          fontSize: "14px",
          fontFamily: "Inter",
          fontWeight: "bold"
        }
      },
      plotOptions: {
        pie: {
          donut: {
            size: "65%"
          },
          expandOnClick: false
        }
      },
      responsive: [{
        breakpoint: 480,
        options: {
          chart: { height: 300 }
        }
      }]
    }).render();


    /*************************************************************
     * 5) ZONE CHARTS (Bar + Marker)
     * 
     * We'll create two bar+marker charts:
     *   A) HomeZonesChart
     *   B) AwayZonesChart
     * 
     * X-axis categories (8 total):
     *   1) A-Buildup  2) A-Midfield  3) A-Wingplay  4) A-LastThird
     *   5) D-Buildup  6) D-Midfield  7) D-Wingplay  8) D-LastThird
     * 
     * The bar's value => the "initial" metric
     * The marker => the "final" metric
     *************************************************************/

    // HOME
    // 4 Attacking (initial, final)
    const homeAttackInitial = [
      numParam("home_attack_initial_buildup"),
      numParam("home_attack_initial_midfield"),
      numParam("home_attack_initial_wingplay"),
      numParam("home_attack_initial_lastthird")
    ];
    const homeAttackFinal = [
      numParam("home_attack_final_buildup"),
      numParam("home_attack_final_midfield"),
      numParam("home_attack_final_wingplay"),
      numParam("home_attack_final_lastthird")
    ];

    // 4 Defending (initial, final)
    const homeDefendInitial = [
      numParam("home_defend_initial_buildup"),
      numParam("home_defend_initial_midfield"),
      numParam("home_defend_initial_wingplay"),
      numParam("home_defend_initial_lastthird")
    ];
    const homeDefendFinal = [
      numParam("home_defend_final_buildup"),
      numParam("home_defend_final_midfield"),
      numParam("home_defend_final_wingplay"),
      numParam("home_defend_final_lastthird")
    ];

    // Merge them into 8 categories
    const homeInitial = [
      ...homeAttackInitial, ...homeDefendInitial
    ]; 
    const homeFinal = [
      ...homeAttackFinal, ...homeDefendFinal
    ];

    // We'll label them as below
    const zoneCategoriesHome = [
      "A-Buildup","A-Midfield","A-Wingplay","A-LastThird",
      "D-Buildup","D-Midfield","D-Wingplay","D-LastThird"
    ];

    new ApexCharts(document.querySelector("#homeZonesChart"), {
      chart: {
        height: 400,
        type: "bar"
      },
      // Series[0] => bars (initial)
      // Series[1] => markers (final)
      series: [
        {
          name: "Home (Initial)",
          type: "bar",
          data: homeInitial
        },
        {
          name: "Home (Final)",
          type: "scatter", // marker-only
          data: homeFinal
        }
      ],
      xaxis: {
        categories: zoneCategoriesHome
      },
      yaxis: {
        title: { text: "Home Zones" }
      },
      plotOptions: {
        bar: {
          columnWidth: "50%"
        }
      },
      markers: {
        size: 8, // marker radius
        shape: "circle",
        strokeColors: "#fff",
        strokeWidth: 2
      },
      colors: [HOME_COLOR, HOME_COLOR], // same color, but one is bar, one is marker
      legend: {
        position: "top"
      },
      title: {
        text: "Home Attacking & Defending (Zones)",
        align: "center",
        style: { fontWeight: "700", fontSize: "16px", fontFamily: "Inter" }
      }
    }).render();


    // AWAY
    const awayAttackInitial = [
      numParam("away_attack_initial_buildup"),
      numParam("away_attack_initial_midfield"),
      numParam("away_attack_initial_wingplay"),
      numParam("away_attack_initial_lastthird")
    ];
    const awayAttackFinal = [
      numParam("away_attack_final_buildup"),
      numParam("away_attack_final_midfield"),
      numParam("away_attack_final_wingplay"),
      numParam("away_attack_final_lastthird")
    ];

    const awayDefendInitial = [
      numParam("away_defend_initial_buildup"),
      numParam("away_defend_initial_midfield"),
      numParam("away_defend_initial_wingplay"),
      numParam("away_defend_initial_lastthird")
    ];
    const awayDefendFinal = [
      numParam("away_defend_final_buildup"),
      numParam("away_defend_final_midfield"),
      numParam("away_defend_final_wingplay"),
      numParam("away_defend_final_lastthird")
    ];

    const awayInitial = [
      ...awayAttackInitial, ...awayDefendInitial
    ];
    const awayFinal = [
      ...awayAttackFinal, ...awayDefendFinal
    ];

    const zoneCategoriesAway = [
      "A-Buildup","A-Midfield","A-Wingplay","A-LastThird",
      "D-Buildup","D-Midfield","D-Wingplay","D-LastThird"
    ];

    new ApexCharts(document.querySelector("#awayZonesChart"), {
      chart: {
        height: 400,
        type: "bar"
      },
      series: [
        {
          name: "Away (Initial)",
          type: "bar",
          data: awayInitial
        },
        {
          name: "Away (Final)",
          type: "scatter",
          data: awayFinal
        }
      ],
      xaxis: {
        categories: zoneCategoriesAway
      },
      yaxis: {
        title: { text: "Away Zones" }
      },
      plotOptions: {
        bar: {
          columnWidth: "50%"
        }
      },
      markers: {
        size: 8,
        shape: "circle",
        strokeColors: "#fff",
        strokeWidth: 2
      },
      colors: [AWAY_COLOR, AWAY_COLOR],
      legend: {
        position: "top"
      },
      title: {
        text: "Away Attacking & Defending (Zones)",
        align: "center",
        style: { fontWeight: "700", fontSize: "16px", fontFamily: "Inter" }
      }
    }).render();


    // A small timeout to ensure final layout is correct
    setTimeout(() => {
      window.dispatchEvent(new Event("resize"));
    }, 100);

  </script>
</body>
</html>
