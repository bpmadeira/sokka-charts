<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Match Stats & Momentum (Manual Resize)</title>
  <!-- Load Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Load the Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #f8f8f8;
      font-family: 'Inter', sans-serif;
    }

    /* 
      We'll use containers that define width in percentages or max-width,
      but rely on manual resizing logic in JavaScript to set canvas dimensions.
    */
    .chart-container {
      width: 90vw;        /* For example, 90% viewport width */
      max-width: 900px;   /* Up to 900px on large screens */
      margin: 20px auto;  
      position: relative; /* So we can measure container size easily */
    }

    /* Just placeholders to visually separate them */
    #barChartContainer {
      margin-bottom: 40px;
    }

    /* The canvases themselves will be sized by JS (no fixed height here). */
    canvas {
      display: block;
      background: #fff;
      /* No default width/height in CSS; let JS set them. */
    }
  </style>
</head>
<body>
  <!-- Container for the Bar Chart -->
  <div class="chart-container" id="barChartContainer">
    <canvas id="statsChart"></canvas>
  </div>
  <!-- Container for the Momentum Chart -->
  <div class="chart-container" id="lineChartContainer">
    <canvas id="momentumChart"></canvas>
  </div>

  <script>
    /*************************************************************
     * 1) PARSE URL PARAMS (no placeholders)
     *************************************************************/
    const params = new URLSearchParams(window.location.search);

    // --- A) Absolute stats for bar chart ---
    const homeShots         = Number(params.get("home_shots")         || 0);
    const awayShots         = Number(params.get("away_shots")         || 0);
    const homeShotsOnGoal   = Number(params.get("home_shots_on_goal") || 0);
    const awayShotsOnGoal   = Number(params.get("away_shots_on_goal") || 0);
    const homeGoalChances   = Number(params.get("home_goal_chances")  || 0);
    const awayGoalChances   = Number(params.get("away_goal_chances")  || 0);
    const homeDuelsWon      = Number(params.get("home_duels_won")     || 0);
    const awayDuelsWon      = Number(params.get("away_duels_won")     || 0);
    const homeSaves         = Number(params.get("home_saves")         || 0);
    const awaySaves         = Number(params.get("away_saves")         || 0);
    const homeCorners       = Number(params.get("home_corners")       || 0);
    const awayCorners       = Number(params.get("away_corners")       || 0);
    const homeFouls         = Number(params.get("home_fouls")         || 0);
    const awayFouls         = Number(params.get("away_fouls")         || 0);
    const homeYellows       = Number(params.get("home_yellows")       || 0);
    const awayYellows       = Number(params.get("away_yellows")       || 0);
    const homeReds          = Number(params.get("home_reds")          || 0);
    const awayReds          = Number(params.get("away_reds")          || 0);

    // If possession is also absolute (e.g., 40 vs 60)
    const possessionHome    = Number(params.get("PossessionHome")     || 0);
    const possessionAway    = Number(params.get("PossessionAway")     || 0);

    // --- B) Momentum chart arrays (CSV format) ---
    const rawTimeTracker    = params.get("time_tracker")    || "0,15,30,45,60,75,90";
    const rawMomentum       = params.get("momentum_tracker") || "0.5,0.55,0.6,0.55,0.4,0.7,0.6";
    const timeData          = rawTimeTracker.split(",").map(v => Number(v.trim()));
    const homeMomentumData  = rawMomentum.split(",").map(v => Number(v.trim()));
    const awayMomentumData  = homeMomentumData.map(v => 1 - v); // away = 1 - home

    /*************************************************************
     * 2) DATA ARRAYS FOR BAR CHART
     *************************************************************/
    const statLabels = [
      "Ball Possession",
      "Shots",
      "Shots on Goal",
      "Goal Chances",
      "Duels Won",
      "Saves",
      "Corners",
      "Fouls",
      "Yellows",
      "Reds"
    ];
    const homeValues = [
      possessionHome,
      homeShots,
      homeShotsOnGoal,
      homeGoalChances,
      homeDuelsWon,
      homeSaves,
      homeCorners,
      homeFouls,
      homeYellows,
      homeReds
    ];
    const awayValues = [
      possessionAway,
      awayShots,
      awayShotsOnGoal,
      awayGoalChances,
      awayDuelsWon,
      awaySaves,
      awayCorners,
      awayFouls,
      awayYellows,
      awayReds
    ];

    /*************************************************************
     * 3) BUILD THE CHARTS (responsive: false)
     *************************************************************/
    // Bar chart
    const barCtx = document.getElementById("statsChart").getContext("2d");
    const barChart = new Chart(barCtx, {
      type: "bar",
      data: {
        labels: statLabels,
        datasets: [
          {
            label: "Home",
            data: homeValues,
            backgroundColor: "#fa3048",
            borderRadius: 6
          },
          {
            label: "Away",
            data: awayValues,
            backgroundColor: "#2c2c2c",
            borderRadius: 6
          }
        ]
      },
      options: {
        responsive: false,  // manual resizing
        maintainAspectRatio: false,
        indexAxis: "y",
        scales: {
          x: {
            grid: { display: false },
            ticks: { display: false },
            beginAtZero: true
          },
          y: {
            grid: { display: false },
            border: { display: false },
            ticks: {
              color: "#000",
              font: {
                family: "Inter",
                weight: "700"
              }
            }
          }
        },
        plugins: {
          legend: {
            display: true,
            position: "top",
            labels: {
              font: {
                family: "Inter",
                weight: "700"
              }
            }
          },
          tooltip: {
            enabled: true,
            titleFont: {
              family: "Inter",
              weight: "700"
            },
            bodyFont: {
              family: "Inter"
            },
            callbacks: {
              label: function(context) {
                const label = context.dataset.label || "";
                const val = context.parsed.x || 0;
                return `${label}: ${val}`;
              }
            }
          }
        }
      }
    });

    // Momentum line chart
    const lineCtx = document.getElementById("momentumChart").getContext("2d");
    const lineChart = new Chart(lineCtx, {
      type: "line",
      data: {
        labels: timeData,
        datasets: [
          {
            label: "Home Momentum",
            data: homeMomentumData,
            borderColor: "#e74c3c",
            borderWidth: 2,
            radius: 0,
            fill: false
          },
          {
            label: "Away Momentum",
            data: awayMomentumData,
            borderColor: "#3498db",
            borderWidth: 2,
            radius: 0,
            fill: false
          }
        ]
      },
      options: {
        responsive: false,   // manual resizing
        maintainAspectRatio: false,
        scales: {
          x: {
            title: {
              display: true,
              text: "Time (minutes)",
              font: {
                family: "Inter",
                weight: "700"
              }
            },
            ticks: {
              font: {
                family: "Inter",
                weight: "700"
              }
            },
            grid: { display: true }
          },
          y: {
            min: 0,
            max: 1,
            title: {
              display: true,
              text: "Momentum",
              font: {
                family: "Inter",
                weight: "700"
              }
            },
            ticks: {
              font: {
                family: "Inter",
                weight: "700"
              }
            },
            grid: { display: true }
          }
        },
        plugins: {
          legend: {
            position: "top",
            labels: {
              font: {
                family: "Inter",
                weight: "700"
              }
            }
          },
          tooltip: {
            mode: "index",
            intersect: false,
            titleFont: {
              family: "Inter",
              weight: "700"
            },
            bodyFont: {
              family: "Inter"
            }
          }
        },
        interaction: {
          mode: "index",
          intersect: false
        }
      }
    });

    /*************************************************************
     * 4) AUTO-RESIZE LOGIC
     *    We'll measure each container and set the canvas size
     *    accordingly, then call chart.update().
     *************************************************************/
    function resizeCharts() {
      // Bar chart
      const barContainer = document.getElementById("barChartContainer");
      // Set canvas to container's dimensions
      barChart.canvas.width  = barContainer.offsetWidth;
      barChart.canvas.height = barContainer.offsetHeight;
      barChart.update();

      // Momentum chart
      const lineContainer = document.getElementById("lineChartContainer");
      lineChart.canvas.width  = lineContainer.offsetWidth;
      lineChart.canvas.height = lineContainer.offsetHeight;
      lineChart.update();
    }

    // DEBOUNCE helper: wait ~200ms after resize stops
    let resizeTimer;
    function debounceResize() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(resizeCharts, 200);
    }

    // Fire once on page load
    resizeCharts();

    // Fire on window resize
    window.addEventListener("resize", debounceResize);
  </script>
</body>
</html>
