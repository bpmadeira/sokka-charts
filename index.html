<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>One Chart Per Stat + Momentum</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #f8f8f8;
      font-family: "Inter", sans-serif;
      text-align: center; /* to center canvases horizontally */
    }

    /*
      We'll place each stat chart in its own canvas, up to 90% viewport width, 
      max 900px, with some vertical margin. 
    */
    .stat-canvas,
    #momentumChart {
      display: inline-block;
      width: 90vw;
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <!-- We'll dynamically insert canvases for each stat here -->
  <div id="stats-container"></div>

  <!-- One canvas for the momentum line chart -->
  <canvas id="momentumChart"></canvas>

  <script>
    /*************************************************************
     * 1) GLOBAL COLOR VARIABLES (HOME/AWAY)
     *************************************************************/
    const HOME_COLOR = "#fa3048";
    const AWAY_COLOR = "#2c2c2c";

    /*************************************************************
     * 2) PARSE URL PARAMS (no placeholders)
     *************************************************************/
    const params = new URLSearchParams(window.location.search);

    // Stats
    const homeShots         = Number(params.get("home_shots")         || 0);
    const awayShots         = Number(params.get("away_shots")         || 0);
    const homeShotsOnGoal   = Number(params.get("home_shots_on_goal") || 0);
    const awayShotsOnGoal   = Number(params.get("away_shots_on_goal") || 0);
    const homeGoalChances   = Number(params.get("home_goal_chances")  || 0);
    const awayGoalChances   = Number(params.get("away_goal_chances")  || 0);
    const homeDuelsWon      = Number(params.get("home_duels_won")     || 0);
    const awayDuelsWon      = Number(params.get("away_duels_won")     || 0);
    const homeSaves         = Number(params.get("home_saves")         || 0);
    const awaySaves         = Number(params.get("away_saves")         || 0);
    const homeCorners       = Number(params.get("home_corners")       || 0);
    const awayCorners       = Number(params.get("away_corners")       || 0);
    const homeFouls         = Number(params.get("home_fouls")         || 0);
    const awayFouls         = Number(params.get("away_fouls")         || 0);
    const homeYellows       = Number(params.get("home_yellows")       || 0);
    const awayYellows       = Number(params.get("away_yellows")       || 0);
    const homeReds          = Number(params.get("home_reds")          || 0);
    const awayReds          = Number(params.get("away_reds")          || 0);

    const possessionHome    = Number(params.get("possessionHome")     || 0);
    const possessionAway    = Number(params.get("possessionAway")     || 0);

    // Momentum
    const rawTimeTracker = params.get("time_tracker")    || "0,15,30,45,60,75,90";
    const rawMomentum    = params.get("momentum_tracker")|| "0.5,0.55,0.6,0.55,0.4,0.7,0.6";
    const timeData       = rawTimeTracker.split(",").map(x => Number(x.trim()));
    const homeMomentumData = rawMomentum.split(",").map(x => Number(x.trim()));
    const awayMomentumData = homeMomentumData.map(v => 1 - v);

    /*************************************************************
     * 3) BUILD AN ARRAY OF STAT OBJECTS (one per chart)
     *    Each object has { label, homeValue, awayValue }
     *************************************************************/
    const statsArray = [
      { label: "Ball Possession", homeValue: possessionHome, awayValue: possessionAway },
      { label: "Shots",           homeValue: homeShots,      awayValue: awayShots },
      { label: "Shots on Goal",   homeValue: homeShotsOnGoal,awayValue: awayShotsOnGoal },
      { label: "Goal Chances",    homeValue: homeGoalChances,awayValue: awayGoalChances },
      { label: "Duels Won",       homeValue: homeDuelsWon,   awayValue: awayDuelsWon },
      { label: "Saves",           homeValue: homeSaves,      awayValue: awaySaves },
      { label: "Corners",         homeValue: homeCorners,    awayValue: awayCorners },
      { label: "Fouls",           homeValue: homeFouls,      awayValue: awayFouls },
      { label: "Yellows",         homeValue: homeYellows,    awayValue: awayYellows },
      { label: "Reds",            homeValue: homeReds,       awayValue: awayReds },
    ];

    /*************************************************************
     * 4) DYNAMICALLY CREATE ONE CHART PER STAT
     *************************************************************/
    const statsContainer = document.getElementById("stats-container");

    statsArray.forEach((stat, index) => {
      // Create a <canvas> for this stat
      const canvas = document.createElement("canvas");
      canvas.className = "stat-canvas";
      canvas.id = `chart-${stat.label.replace(/\s+/g, '-')}`;
      statsContainer.appendChild(canvas);

      // Build the chart
      new Chart(canvas.getContext("2d"), {
        type: "bar",
        data: {
          labels: [ stat.label ], // single category => one row
          datasets: [
            {
              label: "Home",
              data: [ stat.homeValue ],
              backgroundColor: HOME_COLOR,
              borderRadius: 6
            },
            {
              label: "Away",
              data: [ stat.awayValue ],
              backgroundColor: AWAY_COLOR,
              borderRadius: 6
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          indexAxis: "y", // horizontal bar
          plugins: {
            title: {
              display: true,
              text: stat.label, // chart title is the stat label
              font: {
                family: "Inter",
                weight: "700",
                size: 16
              },
              padding: {
                top: 10,
                bottom: 10
              }
            },
            legend: {
              // only show legend for the first chart
              display: (index === 0),
              position: "top",
              labels: {
                font: { family: "Inter", weight: "700" }
              }
            },
            tooltip: {
              titleFont: { family: "Inter", weight: "700" },
              bodyFont:  { family: "Inter" },
              callbacks: {
                label: (ctx) => {
                  const val = ctx.parsed.x || 0;
                  const who = ctx.dataset.label || "";
                  return `${who}: ${val}`;
                }
              }
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: {
                font: { family: "Inter", weight: "700" },
                color: "#666"
              },
              grid: { display: true }
            },
            y: {
              // we have only one category => single row
              ticks: { display: false },  // hide that single label
              grid: { display: false },
            }
          },
          // extra space between bars
          elements: {
            bar: {
              barPercentage: 0.6,       // thickness
              categoryPercentage: 0.8   // vertical spacing
            }
          }
        }
      });
    });

    /*************************************************************
     * 5) MOMENTUM LINE CHART (TRIPLE-THICK LINES, Y up to 1.2)
     *************************************************************/
    new Chart(document.getElementById("momentumChart").getContext("2d"), {
      type: "line",
      data: {
        labels: timeData,
        datasets: [
          {
            label: "Home Momentum",
            data: homeMomentumData,
            borderColor: HOME_COLOR,
            borderWidth: 6, // triple thick
            radius: 0
          },
          {
            label: "Away Momentum",
            data: awayMomentumData,
            borderColor: AWAY_COLOR,
            borderWidth: 6,
            radius: 0
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          x: {
            type: 'linear',
            title: {
              display: true,
              text: "Time (minutes)",
              font: { family: "Inter", weight: "700" }
            },
            ticks: {
              font: { family: "Inter", weight: "700" }
            }
          },
          y: {
            min: 0,
            max: 1.2,
            title: {
              display: true,
              text: "Momentum",
              font: { family: "Inter", weight: "700" }
            },
            ticks: {
              font: { family: "Inter", weight: "700" }
            }
          }
        },
        plugins: {
          legend: {
            position: 'top',
            labels: {
              font: { family: "Inter", weight: "700" }
            }
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            titleFont: { family: "Inter", weight: "700" },
            bodyFont:  { family: "Inter" }
          }
        },
        interaction: {
          mode: 'index',
          intersect: false
        }
      }
    });
  </script>
</body>
</html>
